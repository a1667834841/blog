---
title: 2021-07-15_note
date: 2021-11-09 09:03:17
permalink: /pages/35b601/
sidebar: auto
categories:
  - 随笔
tags:
  - 
---
**mood:** :smile:  																		**date: 2021-07-15**  

## 今日计划  
------
- [x] **正向推NC**，云桂正向推nc,**开过票**且**确认完收货**（两者顺序可换），才推开过票的那部分，开票地方有web
- [ ] **正向推NC**，云桂正向推nc,**开过票**且**确认完收货**（两者顺序可换），才推开过票的那部分，开票地方有app
- [ ] **正向推NC**，云桂正向推nc,**开过票**且**确认完收货**（两者顺序可换），才推开过票的那部分，收货地方有app
- [ ] 推发票，订单修改最后一次推送的金额（发票已测，订单已测）
- [ ] 
  1. 确认收货有app
## 明日计划  
------
- [ ]  
## 随写 
------

| YG202107144096181012026 | 待发货 |
| ----------------------- | ------ |
| YG202107144096181027253 | 待发货 |
| YG202107144096181044551 |        |

1466，1465，1464

```
 // 推发票修改
 
 BigDecimal goodPrice = new BigDecimal(0);
                                // 判断当前商品订单是否是最后一次推送nc
                                // 判断逻辑：可推NC数量（canNcNum） == 开票数量（makeNum）
                                if (canNcNum == makeNum) {
                                    // 如果是，就将商品订单剩余nc金额推送出去
                                    // 商品订单剩余nc金额 = 可推NC金额（canNcPrice）- （商品最终下单数量（num）- 开票数量（makeNum））* 可推NC金额（canNcPrice）/商品最终下单数量（num）
                                    // 新单价
                                    BigDecimal newUnitPrice = canNcPrice.divide(BigDecimal.valueOf(num), 2, BigDecimal.ROUND_HALF_UP);
                                    goodPrice = canNcPrice.subtract(newUnitPrice.multiply(BigDecimal.valueOf((num-makeNum))));
                                } else {
                                    goodPrice = canNcPrice.divide(BigDecimal.valueOf(num), 10, BigDecimal.ROUND_HALF_UP).multiply(BigDecimal.valueOf(makeNum)).setScale(2, BigDecimal.ROUND_HALF_UP);
                                }
                                
  // 只要是推推订单，就是全部推掉，不管之前有没有开过票，这次全部开掉
  // 商品订单剩余nc金额 = 可推NC金额（canNcPrice）- （商品最终下单数量（num）- 开票数量（makeNum））* 可推NC金（canNcPrice）/商品最终下单数量（num）
// 新单价
   BigDecimal newUnitPrice = canNcPrice.divide(BigDecimal.valueOf(num), 2, BigDecimal.ROUND_HALF_UP);
              BigDecimal  goodPrice = canNcPrice.subtract(newUnitPrice.multiply(BigDecimal.valueOf((num-canNcNum))));
                        
                        
```

