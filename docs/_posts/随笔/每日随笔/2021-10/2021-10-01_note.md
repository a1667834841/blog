---
title: 2021-10-01_note
date: 2021-11-09 09:03:17
permalink: /pages/09a156/
sidebar: auto
categories:
  - 随笔
tags:
  - 
---
**mood:** :smile:  																		**date: 2021-10-01**  
## 今日计划  
------
- [x]  本地环境搭建elk
- [x]  公司环境搭建elk
- [x]  事务失效测试
- [x]  easyExcel 合并单元格笔记
- [x]  操作日志工具类
- [ ]  mybatis学习
- [ ]  售后查看，审核完成 
## 明日计划  
------
- [ ]  
## 随写 
------

安装 kibana



```sh
wget https://artifacts.elastic.co/downloads/kibana/kibana-7.14.0-linux-x86_64.tar.gz
sha1sum kibana-7.14.0-linux-x86_64.tar.gz 
tar -xzf kibana-7.14.0-linux-x86_64.tar.gz
cd kibana/ 


#比较 sha1sum 或 shasum 产生的 SHA 跟 发布 SHA是否一致。
#该目录是 $KIBANA_HOME 。
```

./kibana --allow-root

nohup /opt/software/kibana/kibana-7.14.0-linux-x86_64/bin/kibana --allow-root  \>/dev/null 2>&1& 



chmod 777  /opt/software/kibana/kibana-7.14.0-linux-x86_64/logs/kibana.log

/opt/software/kibana/kibana-7.14.0-linux-x86_64/bin/kibana --allow-root -e /opt/software/kibana/kibana-7.14.0-linux-x86_64/config/kibana.yml



ps -ef | grep /kibana-7.14.0-linux-x86_64/node/bin/node| grep -v grep | awk '{print $2}'

```
#! /bin/bash
pid=$(ps -ef | grep kibana-7.14.0-linux-x86_64/node/bin/node| grep -v grep | awk '{print $2}')
if [ -z "$pid" ];
then
 echo "not find es pid , fail to stop!"
else
 kill -9 $pid
 echo "kibanais done , pid=${pid}" 
fi
```



检查状态

```shell
curl localhost:5601/api/status
```



```
wget https://artifacts.elastic.co/downloads/logstash/logstash-7.14.0-linux-x86_64.tar.gz

tar -xzvf logstash-7.14.0-linux-x86_64.tar.gz
```



```conf
input {
    file {
        path => ["/opt/software/logstash/logstash-7.14.0/data/test1.log"]
        start_position => "beginning"
	add_field => {"myid"=>"test1"}
    }

     file {
        path => ["/opt/software/logstash/logstash-7.14.0/data/test2.log"]
        start_position => "beginning"
        add_field => {"myid"=>"test2"}
    }

    file {
        path => ["/opt/jar/log/dev/*.log"]
        start_position => "beginning"
        add_field => {"myid"=>"tool"}
    }

    

}
filter {
    
}
output {
	if [myid] == "test1" {
		elasticsearch {
	   	 hosts => ["http://localhost:9200"]
	   	 index => "test1-log-%{+YYYY.MM.dd}"
	   	 #user => "elastic"
	   	 #password => "changeme"
	  }
	}

	if [myid] == "test2" {
		elasticsearch {
	   	 hosts => ["http://localhost:9200"]
	   	 index => "test2-log-%{+YYYY.MM.dd}"
	   	 #user => "elastic"
	   	 #password => "changeme"
	  }
	}

	if [myid] == "tool" {
		elasticsearch {
	   	 hosts => ["http://localhost:9200"]
	   	 index => "tool-log-%{+YYYY.MM.dd}"
	   	 #user => "elastic"
	   	 #password => "changeme"
	  }
	}
     

}

```



启动logstash

./bin/logstash -f ./config/logstash-sample.conf



```sh
/opt/software/logstash/logstash-7.14.0/bin/logstash -f /opt/software/logstash/logstash-7.14.0/config/logstash-file.conf -t
```

/opt/software/logstash/logstash-7.14.0/data/test.log

