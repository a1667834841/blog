---
title: 什么是多线程并发编程
date: 2022-04-27 15:17:55
permalink: /pages/677800/
categories:
  - 知识库
  - 基础知识
  - java并发编程
tags:
  - 
---
# 什么是多线程并发编程

## 了解什么是并发，什么是并行？
并发：一段时间内，执行多个没有结束的任务。
并行：单位时间内，同时执行多个任务。

**注意：并发任务强调在一个时间段内同时执行，而一个时间段由多个单位时间累积而成，所以说并发的多个任务在单位时间内不一定同时在执行**

> 而在多线程编程实践中，线程的个数往往多于CPU的个数，所以一般都称多线程并发编程而不是多线程并行编程。


## 内存可见性问题

首先看下java的内存模型，可以更好了解问题
![20220427161926](https://img.ggball.top/picGo/20220427161926.png)
 每个线程都有自己的工作内存和缓存（一级缓存），主内存保存存着共享变量，CPU还提供一个共享的二级缓存，如果二级缓存有对应数据，线程会优先取二级缓存获取或刷入

 接下来说一个例子，演示为什么会有内存可见性的问题

![20220427175020](https://img.ggball.top/picGo/20220427175020.png)

------
 假设现在有一个双核cpu服务器，首先thread1 获取x的值，这时候只有共享的主内存有值，二级缓存和thread1的私有内存和一级缓存都没有x的值，因此thread1会直接去主内存获取值。
![20220427175118](https://img.ggball.top/picGo/20220427175118.png)

------
 thread1会直接从主内存，将x=0写入两级缓存，写入私有内存，然后再将x的值修改为1，最后再将x=1刷到两级缓存，和主内存中。

![20220427175237](https://img.ggball.top/picGo/20220427175237.png)

 ------
 这时候来了个thread2,也准备修改x的值，开始时它的私有内存和一级缓存也是空的，但是主内存和二级缓存的x值为1，所以thread2会优先获取二级缓存中的值

![20220427175314](https://img.ggball.top/picGo/20220427175314.png)

 ------
 thread2获取二级缓存x=1,写入自己的一级缓存和私有内存，然后将x修改为2，私有内存和一级缓存都修改为2，x=2也刷入二级缓存和主内存，到这里都没有问题。

![20220427175425](https://img.ggball.top/picGo/20220427175425.png)

  ------
  这时thread1又想将x的值修改为3，thread1看自己的一级缓存有x的值，就不会去二级缓存获取，这样就造成了读取的数据和主内存上的不一致


## 解决内存可见性的方法

### synchronized 关键字
### volatile 关键字