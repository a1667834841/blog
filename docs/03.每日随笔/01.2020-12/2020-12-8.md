---
title: 2020-12-8
date: 2021-10-08 19:46:05
permalink: /pages/9fb749/
categories:
  - 每日随笔
  - 2020-12
tags:
  - 
---
今日计划
1. siteInfo 增加企业code

    alter TABLE ep.site_info add enterprise_code varchar(64);
    COMMENT ON COLUMN "ep"."site_info"."enterprise_code" IS '企业编码';
    
2. 实时监测 增加大气的数据超标逻辑

水质质量

![image-20201208134114414](https://gitee.com/zxqzhuzhu/imgs/raw/c72182b081e7ec0f6098535755de337f6309789d/image-20201208134114414.png)

空气质量

![image-20201208134223842](D:\project\vscode\gitlab\blog\myBlog\docs\每日随笔\2020-12-8.assets\image-20201208134223842.png)



3. 标况实况 功能实现

4. sql server 数据 介入后 环保数据库调整

- 需要接入的数据 `排口表` （废水，废气） ，`小时数据表`（废水，废气），`小时审核表`（废水，废气），`日审核表`（废水，废气）`,小时流量审核表`（废水，废气），排口污染物排放标准，停产信息，监测指标代码表



问题：

排口污染物排放标准  排口的因子标准吗？

停产信息 对应的逻辑？

监测指标代码表 运用到哪？

小时流量审核表 运用到哪？



排口表：

- ​	在site_info 表里存 类型字段 区分 排口和 站点

数据表

- 是不是只需要 环保现在需要的字段，其余的不要
- 排放量字段 下的数据为空，只有监测平均值

审核表

- 审核表怎么存 小时审核表 存入 raw 那天审核表 存入哪里 还是新建一张



- 问题：
- 标准值下限 代表排放量 ，只有监测平均值
- 停产  时 verifyValue 和avgValue 都为null 
- 监测指标代码 所代表的的作用 含义 不明确
- 在site_info 表里存 类型字段 区分 排口和 站点
- 企业停产 表里 设备信息不清楚



1. 新建数据表 关联现有数据表 存折算值，排放值，流速
2. 新建废气废水审核表， 
3. 新建废气废水审核数据状态字典表 查询使用verifyValue 值（修约之后得知）
4. 是否停产 1 代表停产 0 不停产 保留此字段
5. 以后可能配置 因子针对企业，排口上下限
6. 审核表 标准值相关 审核倍数 审核备注 排放量（标准值下限） 审核状态（int 1正常 0 不正常）
7. 排口污染物排放标准   相当于 因子表 
8. 排口表 高度，口径字段添加



alter TABLE ep.site_info add enterprise_code varchar(64);
COMMENT ON COLUMN "ep"."site_info"."enterprise_code" IS '企业编码';


-- 建立废气废水的相关表

-- site_info 站点表
-- 增加 企业编码
alter TABLE ep.site_info add enterprise_code varchar(64);
COMMENT ON COLUMN "ep"."site_info"."enterprise_code" IS '企业编码';
-- 增加 排口代码 对应 PointCode
alter TABLE ep.site_info add out_name varchar(64);
COMMENT ON COLUMN "ep"."site_info"."out_name" IS '排口代码';
-- 增加 是否是排口类型 1 排口 0 不是排口
alter TABLE ep.site_info add is_out int4;
COMMENT ON COLUMN "ep"."site_info"."is_out" IS '是否是排口类型 1 排口 0 不是排口';
-- 增加 是否是停用  1 代表停产 0 不停产  对应 State
alter TABLE ep.site_info add is_continued in4;
COMMENT ON COLUMN "ep"."site_info"."is_continued" IS '是否是停用  1 代表停产 0 不停产';
-- 增加 排放口高度（米） 对应 height
alter TABLE ep.site_info add height in4;
COMMENT ON COLUMN "ep"."site_info"."height" IS '排放口高度（米）';
-- 增加 出口内径（米） 对应 PfkNj
alter TABLE ep.site_info add PfkNj in4;
COMMENT ON COLUMN "ep"."site_info"."PfkNj" IS '排放口高度（米）';



-- 废气小时数据表

DROP TABLE IF EXISTS "ep"."waste_air";
CREATE TABLE "ep"."waste_air" (

 "id" bigserial  PRIMARY KEY, -- 建序列 设主键
  "site_id" int8 NOT NULL, -- 需要根据mn查询
  "factor_id" int4 NOT NULL, -- 根据pol_id 查询
  "mn" varchar(128) not null, -- 对应T_AutoMoni_HourData_Gas.DGIMN
	"standard_value" float8 , -- 对应T_AutoMoni_HourData_Gas.StandardValue
  "min_val" float8, -- 对应T_AutoMoni_HourData_Gas.pMinValue
  "max_val" float8, -- 对应T_AutoMoni_HourData_Gas.pMaxValue
  "avg_val" float8, -- 对应T_AutoMoni_HourData_Gas.PAvgValue
  "count_val" float8, -- 对应T_AutoMoni_HourData_Gas.pCountValue
	"count_Emission_val" float8, -- 对应T_AutoMoni_HourData_Gas.PCumEmission
	"min_emission_val" float8, -- 对应T_AutoMoni_HourData_Gas.pMinEmission
	"max_emission_val" float8, -- 对应T_AutoMoni_HourData_Gas.pMaxEmission
	"avg_emission_val" float8, -- 对应T_AutoMoni_HourData_Gas.pAvgEmission
	"count_multiple_val" float8, -- 对应T_AutoMoni_HourData_Gas.CumExMultiple
	"avg_multiple_val" float8, -- 对应T_AutoMoni_HourData_Gas.AvgExMultiple
	"max_multiple_val" float8, -- 对应T_AutoMoni_HourData_Gas.MaxExMultiple
	"min_multiple_val" float8, -- 对应T_AutoMoni_HourData_Gas.MinExMultiple
	
	"sample_time" timestamp(0) NOT NULL, -- 对应T_AutoMoni_HourData_Gas.Datatime
	"update_time" timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
  "create_time" timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP


);

COMMENT ON COLUMN "ep"."waste_air"."site_id" IS '站点id';
COMMENT ON COLUMN "ep"."waste_air"."factor_id" IS '因子id';
COMMENT ON COLUMN "ep"."waste_air"."mn" IS '数采仪编码';
COMMENT ON COLUMN "ep"."waste_air"."standard_value" IS '标准值';
COMMENT ON COLUMN "ep"."waste_air"."sample_time" IS '监测时间';
COMMENT ON COLUMN "ep"."waste_air"."min_val" IS '监测最小值';
COMMENT ON COLUMN "ep"."waste_air"."max_val" IS '监测最大值';
COMMENT ON COLUMN "ep"."waste_air"."avg_val" IS '监测平均值';
COMMENT ON COLUMN "ep"."waste_air"."count_val" IS '监测累计值';

COMMENT ON COLUMN "ep"."waste_air"."count_Emission_val" IS '累计排放量: 用折算值来算';
COMMENT ON COLUMN "ep"."waste_air"."min_emission_val" IS '最小排放量: 用折算值来算';
COMMENT ON COLUMN "ep"."waste_air"."max_emission_val" IS '最大排放量: 用折算值来算';
COMMENT ON COLUMN "ep"."waste_air"."avg_emission_val" IS '平均排放量: 用折算值来算';

COMMENT ON COLUMN "ep"."waste_air"."avg_multiple_val" IS '平均排放量: 用折算值来算';
COMMENT ON COLUMN "ep"."waste_air"."max_multiple_val" IS '最大排放量: 用折算值来算';
COMMENT ON COLUMN "ep"."waste_air"."min_multiple_val" IS '最小排放量: 用折算值来算';
COMMENT ON COLUMN "ep"."waste_air"."count_multiple_val" IS '累计超标倍数';
COMMENT ON COLUMN "ep"."waste_air"."avg_multiple_val" IS '平均超标倍数';
COMMENT ON COLUMN "ep"."waste_air"."max_multiple_val" IS '最大超标倍数';
COMMENT ON COLUMN "ep"."waste_air"."min_multiple_val" IS '最小超标倍数';

-- 废气小时审核表

DROP TABLE IF EXISTS "ep"."waste_air_checked";
CREATE TABLE "ep"."waste_air" (

 "id" bigserial  PRIMARY KEY, -- 建序列 设主键
 "site_id" int8 NOT NULL, -- 需要根据mn查询
 "factor_id" int4 NOT NULL, -- 根据pol_id 查询
 "mn" varchar(128) COLLATE "pg_catalog"."default", -- 对应T_AutoMoni_PolVerifyData_Gas.DGIMN
 "verify_value" float8 -- 对应T_AutoMoni_PolVerifyData_Gas.VerifyValue
 "avg_value" float8 -- 对应T_AutoMoni_PolVerifyData_Gas.AvgValue
 "standard_value" float8 , -- 对应T_AutoMoni_PolVerifyData_Gas.StandardValue
 "standard_max_value" float8 , -- 对应T_AutoMoni_PolVerifyData_Gas.StandardMaxValue
 "emission" float8 , -- 对应T_AutoMoni_PolVerifyData_Gas.StandardMinValue 排放量-标准值下限 
 "exceeded_multiple" FLOAT8 , -- 对应T_AutoMoni_PolVerifyData_Gas.ExceededMultiple
 "code_verify_source" VARCHAR(32) , -- 对应T_AutoMoni_PolVerifyData_Gas.Code_VerifySource
 "remark" varchar(256) , -- 对应T_AutoMoni_PolVerifyData_Gas.Remark
 "verify_state" int4 , -- 对应T_AutoMoni_PolVerifyData_Gas.VerifyState
 "verify_time" TIMESTAMP , -- 对应T_AutoMoni_PolVerifyData_Gas.VerrifyTime
 "data_state" int4 , -- 对应T_AutoMoni_PolVerifyData_Gas.DataState
 "is_continued" int4 , -- 对应T_AutoMoni_PolVerifyData_Gas.Code_StopWork  1 代表停产 0 不停产


 "sample_time" timestamp(0) NOT NULL, -- 对应T_AutoMoni_PolVerifyData_Gas.Datatime
 "update_time" timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
 "create_time" timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP
	
 );

 -- 废气废水数据字典表

DROP TABLE IF EXISTS "ep"."waste_data_state";
CREATE TABLE "ep"."waste_data_state" (

"id" bigserial  PRIMARY KEY, -- 建序列 设主键
"code" int4 not null,
"name" VARCHAR(64) not NULL,
"update_time" timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP,
"create_time" timestamp(0) NOT NULL DEFAULT CURRENT_TIMESTAMP

);

COMMENT ON COLUMN "ep"."waste_data_state"."code" IS '数据类型编码';
COMMENT ON COLUMN "ep"."waste_data_state"."name" IS '数据类型名称';

-- 废气日数据表
-- 废气日审核表

-- 废气流量表
-- 停产信息表


