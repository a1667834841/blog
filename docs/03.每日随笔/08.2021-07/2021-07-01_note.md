---
title: 2021-07-01_note
date: 2021-10-08 19:46:05
permalink: /pages/444702/
categories:
  - 每日随笔
  - 2021-07
tags:
  - 
---
**mood:** :smile:  																		**date: 2021-07-01**  

## 今日计划  
------
- [ ]  
## 明日计划  
------
- [ ]  
## 随写 
------

```
#修改Docker服务文件，需要先切换到root用户
vim /lib/systemd/system/docker.service
#注释掉"ExecStart"这一行，并添加下面这一行信息
ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock -H tcp://0.0.0.0:23751

```

重新加载配置文件

```
#重新加载配置文件
systemctl daemon-reload
#重启服务
systemctl restart docker.service
#查看配置的端口号（2375）是否开启（非必要）
netstat -nlpt  #如果找不到netstat命令，可以先安装一下这个工具，具体百度
```

``` 
GiftOrderServiceImpl 3557
```

```
 // 为了让开票金额和已修改的订单总金额相等，计算最后一个订单金额时，直接补齐，使得开票金额与订单总金额相等
        if (Lists.isNotNullOrEmpty(giftOrderCommodities) && giftOrderCommodities.size() == 1) {
            GiftOrderCommodity giftOrderCommodity = giftOrderCommodities.get(0);
            Integer numNew = giftOrderCommodity.getNumNew();
            BigDecimal sellPriceNew = giftOrderCommodity.getSellPriceNew();
            BigDecimal commodityPrice = sellPriceNew.multiply(BigDecimal.valueOf(numNew));
            BigDecimal canNcPrice = commodityPrice.divide(priceCommodityOrderIndb, 10, BigDecimal.ROUND_HALF_UP).multiply(priceShouldNew).setScale(2, BigDecimal.ROUND_HALF_UP);
            GiftOrderCommodity giftOrderCommodityUpdate = new GiftOrderCommodity();
            giftOrderCommodityUpdate.setCommodityBillId(giftOrderCommodity.getCommodityBillId());
            giftOrderCommodityUpdate.setCanNcPrice(canNcPrice);
            giftOrderCommodityDao.updateByPrimaryKeySelective(giftOrderCommodityUpdate);
        } else {
            BigDecimal priceDifference = priceShouldNew;
            for (int i = 0; i < giftOrderCommodities.size()-1; i++) {
                GiftOrderCommodity giftOrderCommodity = giftOrderCommodities.get(i);
                Integer numNew = giftOrderCommodity.getNumNew();
                BigDecimal sellPriceNew = giftOrderCommodity.getSellPriceNew();
                BigDecimal commodityPrice = sellPriceNew.multiply(BigDecimal.valueOf(numNew));
                BigDecimal canNcPrice = commodityPrice.divide(priceCommodityOrderIndb, 10, BigDecimal.ROUND_HALF_UP).multiply(priceShouldNew).setScale(2, BigDecimal.ROUND_HALF_UP);
                GiftOrderCommodity giftOrderCommodityUpdate = new GiftOrderCommodity();
                giftOrderCommodityUpdate.setCommodityBillId(giftOrderCommodity.getCommodityBillId());
                giftOrderCommodityUpdate.setCanNcPrice(canNcPrice);
                int giftOrderCommodityCount = giftOrderCommodityDao.updateByPrimaryKeySelective(giftOrderCommodityUpdate);
                if (giftOrderCommodityCount > 0) {
                    priceDifference = priceDifference.subtract(canNcPrice);
                }
            }
            // 处理最后一个
            GiftOrderCommodity giftOrderCommodity = giftOrderCommodities.get(giftOrderCommodities.size() - 1);
            GiftOrderCommodity giftOrderCommodityUpdate = new GiftOrderCommodity();
            giftOrderCommodityUpdate.setCommodityBillId(giftOrderCommodity.getCommodityBillId());
            giftOrderCommodityUpdate.setCanNcPrice(priceDifference);
            int update = giftOrderCommodityDao.updateByPrimaryKeySelective(giftOrderCommodityUpdate);
            if (update > 0) {
                log.error("canNcPrice 改价成功");
            }
        }

//        for (GiftOrderCommodity giftOrderCommodity : giftOrderCommodities) {
//            Integer numNew = giftOrderCommodity.getNumNew();
//            BigDecimal sellPriceNew = giftOrderCommodity.getSellPriceNew();
//            BigDecimal commodityPrice = sellPriceNew.multiply(BigDecimal.valueOf(numNew));
//            BigDecimal canNcPrice = commodityPrice.divide(priceCommodityOrderIndb, 10, BigDecimal.ROUND_HALF_UP).multiply(priceShouldNew).setScale(2, BigDecimal.ROUND_HALF_UP);
//            GiftOrderCommodity giftOrderCommodityUpdate = new GiftOrderCommodity();
//            giftOrderCommodityUpdate.setCommodityBillId(giftOrderCommodity.getCommodityBillId());
//            giftOrderCommodityUpdate.setCanNcPrice(canNcPrice);
//            giftOrderCommodityDao.updateByPrimaryKeySelective(giftOrderCommodityUpdate);
//        }
//        // 修改已申请开票开票金额
//        List<InvoiceInfo> invoiceInfos = invoiceInfoDao.selectByOrderBillIdEquals(orderBillId);
//        for (InvoiceInfo invoiceInfo:invoiceInfos){
//            InvoiceInfo invoiceInfoUpdate = new InvoiceInfo();
//            invoiceInfoUpdate.setId(invoiceInfo.getId());
//            invoiceInfoUpdate.setMoneyMake(invoiceInfo.getMoneyMake().multiply(priceShouldNew.divide(priceCommodityOrderIndb, BigDecimal.ROUND_HALF_UP, 2)).setScale(BigDecimal.ROUND_HALF_UP, 2));
//            invoiceInfoDao.updateByPrimaryKeySelective(invoiceInfoUpdate);
//        }
```

