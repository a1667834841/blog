---
title: 2022-09-28_note
date: 2022-11-13 23:10:12
permalink: /pages/de32aa/
categories:
  - 每日随笔
  - 2022-09
tags:
  - 
---
**mood:** :smile:  									**date: 2022-09-28**  
## 今日计划  
------
- [ ]  premain完成计算方法执行耗时
- [ ]  agentmain demo运行成功
- [ ]  15个单词
## 明日计划  
------
- [ ]  
## 随写 
------

```
mvn -Dmaven.multiModuleProjectDirectory=D:\project\idea\ggball_test\agent_demo -DskipTests=true package
```

安卓和pc建立tcp连接程序





问题1:使用redefineClasses方式时，Caused by: java.lang.UnsupportedOperationException: redefineClasses is not supported in this environment 

通过在MANIFEST.MF增加配置Can-Redefine-Classes: true解决 
问题2：Failed to find Premain-Class manifest attribute 

通过在MANIFEST.MF增加配置 Premain-Class: xxx 或者 将 MANIFREST.MF的配置全部复制到 MANIFEST.MF文件中



```MF
Exception in thread "main" com.sun.tools.attach.AgentLoadException: Agent JAR not found or no Agent-Class attribute
	at jdk.attach/sun.tools.attach.HotSpotVirtualMachine.loadAgent(HotSpotVirtualMachine.java:146)
	at jdk.attach/com.sun.tools.attach.VirtualMachine.loadAgent(VirtualMachine.java:538)
	at com.zhu.agentmain.AgentMainSimpleTest.main(AgentMainSimpleTest.java:27)
Failed to find Agent-Class manifest attribute from D:\project\idea\ggball_test\agent_demo\agent\target\java_agent.jar

MANIFEST文件添加（注意空格）
Manifest-Version: 1.0
Agent-Class: com.package.AgentLoader.agentNameHere
Permissions: all-permissions
```

Can not attach to current VM

java9将vm参数 `jdk.attach.allowAttachSelf`默认为null，所以ALLOW_ATTACH_SELF=false,会抛出`Can not attach to current VM`异常

![image-20220928232854451](https://img.ggball.top/img/image-20220928232854451.png?picGo)

![image-20220928232912418](https://img.ggball.top/img/image-20220928232912418.png?picGo)

解决办法：使用java8或启动加上`-Djdk.attach.allowAttachSelf=true`参数

![image-20220928233053803](https://img.ggball.top/img/image-20220928233053803.png?picGo)

程序包com.sun.tools.attach不存在

![image-20220929133619521](https://img.ggball.top/img/image-20220929133619521.png?picGo)

![image-20220929134121189](https://img.ggball.top/img/image-20220929134121189.png?picGo)

![image-20220929134140811](https://img.ggball.top/img/image-20220929134140811.png?picGo)

```xml
  <dependency>
            <groupId>com.sun</groupId>
            <artifactId>tools</artifactId>
            <version>1.8.0</version>
            <scope>system</scope>
            <systemPath>C:\\Program Files\\Java\\jdk1.8.0_341\\lib\\tools.jar</systemPath>
        </dependency>
```

