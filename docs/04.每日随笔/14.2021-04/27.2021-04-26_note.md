---
title: 2021-04-26_note
date: 2022-11-13 23:10:11
permalink: /pages/5422a3/
categories:
  - 每日随笔
  - 2021-04
tags:
  - 
---
**mood:** :smile:  																		**date: 2021-04-26**  
## 今日计划  
------
- [ ]  mysql 性能监控
- [ ]  接口文档编辑



## 明日计划  
------
- [ ]  
## 随写 
------

show profiles 显示分析信息，指示在当前会话过程中执行的语句的资源使用情况。

```sql
SHOW PROFILE [type [, type] ... ]
    [FOR QUERY n]
    [LIMIT row_count [OFFSET offset]]

type: {
    ALL 显示所有信息
  | BLOCK IO 显示块输入和输出操作的计数
  | CONTEXT SWITCHES 上下文切换显示自愿和非自愿上下文切换的计数
  | CPU CPU 显示用户和系统 CPU 使用时间
  | IPC IPC 显示发送和接收消息的计数
  | MEMORY 当前没有实现
  | PAGE FAULTS  显示主要和次要页面错误的计数
  | SOURCE 显示源代码中函数的名称，以及函数发生在其中的文件的名称和行号
  | SWAPS 显示掉期计数
}

-- Profiling is enabled per session. When a session ends, its profiling information is lost. 每个会话都启用分析。当会话结束时，其分析信息将丢失。
```

使用show profiles 查询之前的sql语句查询速度



- **开启profiling**

> o control profiling, use the [`profiling`](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_profiling) session variable, which has a default value of 0 (`OFF`). Enable profiling by setting [`profiling`](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_profiling) to 1 or `ON`:
>
> 若要控制分析，请使用分析会话变量，该变量的默认值为0(OFF)。通过将配置文件设置为1或 ON 启用配置文件:

```sql
mysql> SET profiling = 1;
```

- **实例**

```sql
mysql> SELECT @@profiling;
+-------------+
| @@profiling |
+-------------+
|           0 |
+-------------+
1 row in set (0.00 sec)

mysql> SET profiling = 1;
Query OK, 0 rows affected (0.00 sec)

mysql> DROP TABLE IF EXISTS t1;
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql> CREATE TABLE T1 (id INT);
Query OK, 0 rows affected (0.01 sec)

mysql> SHOW PROFILES;
+----------+----------+--------------------------+
| Query_ID | Duration | Query                    |
+----------+----------+--------------------------+
|        0 | 0.000088 | SET PROFILING = 1        |
|        1 | 0.000136 | DROP TABLE IF EXISTS t1  |
|        2 | 0.011947 | CREATE TABLE t1 (id INT) |
+----------+----------+--------------------------+
3 rows in set (0.00 sec)

mysql> SHOW PROFILE;
+----------------------+----------+
| Status               | Duration |
+----------------------+----------+
| checking permissions | 0.000040 |
| creating table       | 0.000056 |
| After create         | 0.011363 |
| query end            | 0.000375 |
| freeing items        | 0.000089 |
| logging slow query   | 0.000019 |
| cleaning up          | 0.000005 |
+----------------------+----------+
7 rows in set (0.00 sec)

mysql> SHOW PROFILE FOR QUERY 1;
+--------------------+----------+
| Status             | Duration |
+--------------------+----------+
| query end          | 0.000107 |
| freeing items      | 0.000008 |
| logging slow query | 0.000015 |
| cleaning up        | 0.000006 |
+--------------------+----------+
4 rows in set (0.00 sec)

mysql> SHOW PROFILE CPU FOR QUERY 2;
+----------------------+----------+----------+------------+
| Status               | Duration | CPU_user | CPU_system |
+----------------------+----------+----------+------------+
| checking permissions | 0.000040 | 0.000038 |   0.000002 |
| creating table       | 0.000056 | 0.000028 |   0.000028 |
| After create         | 0.011363 | 0.000217 |   0.001571 |
| query end            | 0.000375 | 0.000013 |   0.000028 |
| freeing items        | 0.000089 | 0.000010 |   0.000014 |
| logging slow query   | 0.000019 | 0.000009 |   0.000010 |
| cleaning up          | 0.000005 | 0.000003 |   0.000002 |
+----------------------+----------+----------+------------+
7 rows in set (0.00 sec)


```



> **Note 注意**
>
> The [`SHOW PROFILE`](https://dev.mysql.com/doc/refman/8.0/en/show-profile.html) and [`SHOW PROFILES`](https://dev.mysql.com/doc/refman/8.0/en/show-profiles.html) statements are deprecated; expect them to be removed in a future MySQL release. Use the [Performance Schema](https://dev.mysql.com/doc/refman/8.0/en/performance-schema.html) instead; see [Section 27.19.1, “Query Profiling Using Performance Schema”](https://dev.mysql.com/doc/refman/8.0/en/performance-schema-query-profiling.html).
>
> 不推荐使用 showprofile 和 showprofiles 语句; 希望在将来的 MySQL 版本中删除它们。请使用性能模式; 请参阅第27.19.1节“使用性能模式进行查询分析”。