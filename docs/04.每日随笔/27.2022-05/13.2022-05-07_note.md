---
title: 2022-05-07_note
date: 2022-11-13 23:10:11
permalink: /pages/93ac67/
categories:
  - 每日随笔
  - 2022-05
tags:
  - 
---
**mood:** :smile:  									**date: 2022-05-07**  
## 今日计划  
------
- [ ]  
- [ ]  15个单词
## 明日计划  
------
- [ ]  
## 随写 
------



# 规范与重构

## 了解重构



### 重构的目的：为什么要重构（why）？

重构的含义

> 重构是一种对软件内部结构的改善，目的是在不改变软件的可见行为的情况下，使其更易理解，修改成本更低

重构的意义

首先，重构是时刻保证代码质量的一个极其有效的手段，不至于让代码腐化到无可救药的地步。

其次，优秀的代码或架构不是一开始就能完全设计好的，就像优秀的公司和产品也都是迭代出来的。

最后，重构是**避免过度设计的有效手段**。

**重构对一个工程师本身技术的成长也有重要的意义。**

### 重构的对象：到底重构什么（what）？

根据重构的规模，我们可以笼统地分为大规模高层次重构（以下简称为“大型重构”）和小规模低层次的重构（以下简称为“小型重构”）。

### 重构的时机：什么时候重构（when）？

当开发时，有时间就可以思考下，自己以前写的东西是否可以优化，其实就是边开发边重构。

开发者应该拥有持续重构意识。

### 重构的方法：又该如何重构（how）？

大规模高层次的重构难度比较大，需要组织、有计划地进行，分阶段地小步快跑，时刻让代码处于一个可运行的状态。而小规模低层次的重构，因为影响范围小，改动耗时短，所以，只要你愿意并且有时间，随时随地都可以去做。



## 为了保证重构不出错，使用单元测试技术手段

### 1. 什么是单元测试？

单元测试是代码层面的测试，由研发自己来编写，用于测试“自己”编写的代码的逻辑的正确性。单元测试顾名思义是测试一个“单元”，有别于集成测试，这个“单元”一般是类或函数，而不是模块或者系统。

### 2. 为什么要写单元测试？

写单元测试的过程本身就是代码 Code Review 和重构的过程，能有效地发现代码中的 bug 和代码设计上的问题。除此之外，单元测试还是对集成测试的有力补充，还能帮助我们快速熟悉代码，是 TDD 可落地执行的改进方案。

### 3. 如何编写单元测试？

写单元测试就是针对代码设计各种测试用例，以覆盖各种输入、异常、边界情况，并将其翻译成代码。我们可以利用一些测试框架来简化单元测试的编写。除此之外，对于单元测试，我们需要建立以下正确的认知：

编写单元测试尽管繁琐，但并不是太耗时；

我们可以稍微放低对单元测试代码质量的要求；

覆盖率作为衡量单元测试质量的唯一标准是不合理的；

单元测试不要依赖被测代码的具体实现逻辑；

单元测试框架无法测试，多半是因为代码的可测试性不好。

### 4. 单元测试为何难落地执行？**

一方面，写单元测试本身比较繁琐，技术挑战不大，很多程序员不愿意去写；另一方面，国内研发比较偏向“快、糙、猛”，容易因为开发进度紧，导致单元测试的执行虎头蛇尾。最后，关键问题还是团队没有建立对单元测试正确的认识，觉得可有可无，单靠督促很难执行得很好。



**课堂讨论**

1. 你参与的项目有没有写单元测试？单元测试是否足够完备？贯彻执行写单元测试的过程中，遇到过哪些问题？又是如何解决的？

2. 在面试中，我经常会让候选人写完代码之后，列举几个测试用例，以此来考察候选人考虑问题是否全面，特别是针对一些边界条件的处理。所以，今天的另一个课堂讨论话题就是：写一个二分查找的变体算法，查找递增数组中第一个大于等于某个给定值的元素，并且为你的代码设计完备的单元测试用例。

个人回答：

1. 没有怎么写过单元测试，一般只是把一个业务当做测试代码来测，这样只能保证代码主业务线是通的，但是测试不到边界问题，而且每个函数测试不到
2. [代码](https://gitee.com/zxqzhuzhu/ggball_test/blob/master/geekbang/src/main/java/com/zhu/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B%E7%BE%8E/UnitTestQuestion.java)