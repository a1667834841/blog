---
title: 2022-06-27_note
date: 2022-11-13 23:10:12
permalink: /pages/6ff3b4/
categories:
  - 每日随笔
  - 2022-06
tags:
  - 
---
**mood:** :smile:  									**date: 2022-06-27**  
## 今日计划  
------
- [x]  设计模式实战
- [x] 并发编程（2）
- [x] threejs demo
- [ ]  15个单词
## 明日计划  
------
- [ ]  
## 随写 
------

```
{"keyword":"开篇词丨从今天起，跨过“数据结构与算法”这道坎","cateory":"","size":20,"prev":1,"platform":"pc"}
```

SqlSessionFactoryBuilder  虽然以Builder结尾，SqlSessionFactory是利用了SqlSessionFactoryBuilder创建的，但是

SqlSessionFactory本身的创建并不复杂，SqlSessionFactoryBuilder同样也有很多重载方法，并不像一般的builder模式，算是另类的builder模式。

> SqlSessionFactoryBuilder设计的初衷只不过是为了简化开发。因为构建SqlSessionFactory需要先构建Configuration，而构建Configuration是非常复杂的，需要做很多工作，比如配置的读取、解析、创建n多对象等。为了将构建SqlSessionFactory的过程隐藏起来，对程序员透明，MyBatis就设计了SqlSessionFactoryBuilder类封装这些构建细节。



如果抽象类中包含模板方法，模板方法调用有待子类实现的抽象方法，那这一般就是模板模式的代码实现。而且，在命名上，模板方法与抽象方法一般是一一对应的，抽象方法在模板方法前面多一个“do”，比如，**在BaseExecutor类中，其中一个模板方法叫update()，那对应的抽象方法就叫doUpdate()**。



在cpu往内存写入数据

cpu写操作，不是立马就将数据写入内存，而是先写入cpu缓存再写入内存，当cpu缓存有了数据，但是还未写入内存，这时候会出现cpu缓存和内存数据不一致的情况

针对写回内存的时机有两种方案

- 写直达（*Write Through*）
- 写回（*Write Back*）？

上面只是在一个cpu中的一个核上说的问题，下面将要说，如果多个cpu存在多个核，不同cpu核上之间的缓存关系，以及缓存和内存的关系

同步cpu之间的核数据不一致问题

- 第一点，某个 CPU 核心里的 Cache 数据更新时，必须要传播到其他核心的 Cache，这个称为**写传播（\*Write Propagation\*）**；（实现方式【总线嗅探】）
- 第二点，某个 CPU 核心里对数据的操作顺序，必须在其他核心看起来顺序是一样的，这个称为**事务的串形化（\*Transaction Serialization\*）**。（实现方式【MESI 协议】）

要实现事务串形化，要做到 2 点：

- CPU 核心对于 Cache 中数据的操作，需要同步给其他 CPU 核心；
- 要引入「锁」的概念，如果两个 CPU 核心里有相同数据的 Cache，那么对于这个 Cache 数据的更新，只有拿到了「锁」，才能进行对应的数据更新。



## MESI 协议

MESI 协议其实是 4 个状态单词的开头字母缩写，分别是：

- *Modified*，已修改
- *Exclusive*，独占
- *Shared*，共享
- *Invalidated*，已失效

