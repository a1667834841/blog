---
title: 2022-06-29_note
date: 2022-11-13 23:10:12
permalink: /pages/17b401/
categories:
  - 每日随笔
  - 2022-06
tags:
  - 
---
**mood:** :smile:  									**date: 2022-06-29**  
## 今日计划  
------
- [ ]  
- [ ]  15个单词
## 明日计划  
------
- [ ]  
## 随写 
------

```
          sed -i 's/$COOKIE/${{secrets.COOKIE}}/' ./config.js
          
           npm install
          cp config.example.js config.js
          echo '${{secrets.COOKIE}}'
          sed -i 's/$COOKIE/MT-Token-Wap=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJtdCIsImV4cCI6MTY1NzE1OTA4OSwidXNlcklkIjoxMDcwMzQxOTY5LCJkZXZpY2VJZCI6ImNsaXBzX0xCOG1GQ1ZBSTBFaUdpNGNMVXgrR25sT0xVNHNIQ1FWSVJjbFFDVWNmVTg9IiwiaWF0IjoxNjU0NTY3MDg5fQ.WFBTcLDbQ_TFeIzHWeKNzKIlMEiHnj9rpRdJG6c_hvM; MT-Device-ID-Wap=clips_LB8mFCVAI0EiGi4cLUx+GnlOLU4sHCQVIRclQCUcfU8=; YX_SUPPORT_WEBP=1/' ./config.js
          b90bca095c0d150babcb0f5af120fe91
          sed -i 's/$DEVICEID/b90bca095c0d150babcb0f5af120fe91/' ./config.js
          pm2 start script.json
          pm2 logs xmtravel --out --lines=100 
```

幂等接口需要关注的地方

1. 调用方调用服务端

2. 服务端处理业务

3. 服务端响应调用方

```mermaid
graph LR
调用方-- 1.请求 -->服务端
服务端--添加幂等号--> 2.处理业务 -- 移除幂等号--> 服务端
服务端-- 3.响应 -->调用方
```

异常出现再1,3都不会影响幂等，只有2出现异常会影响幂等，有以下异常：

业务异常：需要开发人员针对异常来决定是否删除幂等号

系统异常：1.采用分布式框架，不赞同作者先存数据库再存redis 如果系统宕机了，数据库中的幂等号会被回滚，但是redis仍然存在，回复之后，后面的请求依然不会进来，无论当时业务有没有执行成功

幂等框架异常处理：那么也让业务请求失败，失败总比成功或者重试好，修复数据的成本少

![image-20220629163757456](D:%5Cproject%5Cvscode%5Cblog%5Cblogs%5C%E6%AF%8F%E6%97%A5%E9%9A%8F%E7%AC%94%5C2022-06-29_note.assets%5Cimage-20220629163757456.png)





node 使用 require 引入文件 会执行文件所有内容！！