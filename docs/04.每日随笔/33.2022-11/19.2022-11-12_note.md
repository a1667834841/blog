---
title: 2022-11-12_note
date: 2022-11-13 23:10:12
permalink: /pages/a5ff5d/
categories:
  - 每日随笔
  - 2022-11
tags:
  - 
---
**mood:** :smile:  									**date: 2022-11-12**  
## 今日计划  
------
- [ ]  
- [ ]  15个单词
## 明日计划  
------
- [ ]  
## 随写 
------



[redis命令](https://www.runoob.com/redis/redis-commands.html)

聚合统计：

利用set集合 去重的特性，多个集合之间取交集（sinter），并集（sunion），差集（sdiff）

![image-20221112160312180](https://img.ggball.top/img/image-20221112160312180.png?picGo)

排序统计：

可以利用list插入时顺序来排序（lpush + lrange），或者利用sorted-set 的权重来排序 （zadd  + zrangebyscore ）

![image-20221112160627231](https://img.ggball.top/img/image-20221112160627231.png?picGo)

二值状态统计

二值状态统计。这里的二值状态就是指集合元素的取值就只有 0 和 1 两种。在签到打卡的场景中，我们只用记录签到（1）或未签到（0），所以它就是非常典型的二值状态;

Bitmap 本身是用 String 类型作为底层数据结构实现的一种统计二值状态的数据类型。String 类型是会保存为二进制的字节数组，所以，Redis 就把字节数组的每个 bit 位利用起来，用来表示一个元素的二值状态。你可以把 Bitmap 看作是一个 bit 数组。

> Bitmap 支持用 BITOP 命令对多个 Bitmap 按位做“与”“或”“异或”的操作

那么，具体该怎么用 Bitmap 进行签到统计呢？我还是借助一个具体的例子来说明。

假设我们要统计 ID 3000 的用户在 2020 年 8 月份的签到情况，就可以按照下面的步骤进行操作。

第一步，执行下面的命令，记录该用户 8 月 3 号已签到。

```java
SETBIT uid:sign:3000:202008 2 1 
```

第二步，检查该用户 8 月 3 日是否签到。

```java
GETBIT uid:sign:3000:202008 2 
```

第三步，统计该用户在 8 月份的签到次数。

```java
BITCOUNT uid:sign:3000:202008
```

这样，我们就知道该用户在 8 月份的签到情况了



统计一亿个用户十天内又没有连续签到

​	![image-20221112163317452](https://img.ggball.top/img/image-20221112163317452.png?picGo)





基数统计

基数统计就是指统计一个集合中不重复的元素个数

在统计uv(页面访客个数)的场景，使用set集合，hash都能达到目的，缺点就是内存消耗高。

使用HyperLogLog 可以极大降低内存的使用，缺点就是准确率会下降,标准误算率是 0.81%

> HyperLogLog 是一种用于统计基数的数据集合类型，它的最大优势就在于，当集合元素数量非常多时，它计算基数所需的空间总是固定的，而且还很小。

![图片](https://static001.geekbang.org/resource/image/c0/6e/c0bb35d0d91a62ef4ca1bd939a9b136e.jpg)

引用

[有一亿个keys要统计，应该用哪种集合？](https://ggball.top/pages/226b6c/#%E4%BA%8C%E5%80%BC%E7%8A%B6%E6%80%81%E7%BB%9F%E8%AE%A1)