---
title: 2022-10-25_note
date: 2022-11-13 23:10:12
permalink: /pages/f9a3f0/
categories:
  - 每日随笔
  - 2022-10
tags:
  - 
---
**

**mood:** :smile:  									**date: 2022-10-25**  

## 今日计划  
------
- [ ]  修改便利店数据（2h）
- [ ]  查看结算单应收款对不上原因（1h）
- [ ]  15个单词
## 明日计划  
------
- [ ]  
## 随写 
------

问题

![image-20221025100511118](https://img.ggball.top/img/image-20221025100511118.png?picGo)

1. 这个流水好像又重复了，需要去掉一条

2. 18620  状态改为erp推送失败(已修改)



查看redis版本

1、启动服务端：redis-server

2、启动客户端：redis-cli

3、客户端输入：info



![image-20221025155837239](https://img.ggball.top/img/image-20221025155837239.png?picGo)



```
# 开启redis混合持久化（redis6 6默认开启）
$ cat redis.conf
appendonly yes
aof-use-rdb-preamble yes
```

```
docker run -p 6379:6379 -v D:\docker\volumes\redis\redis.conf:/etc/redis/redis.conf -v D:\docker\volumes\redis\data:/data --name myredis -d redis:latest


docker run -p 6379:6379 -v /opt/conf/redis/redis.conf:/etc/redis/redis.conf -v /opt/conf/redis/data:/data --name myredis -d registory.dongshanxia.top:35000/redis:latest

docker run -p 6379:6379 -v /opt/conf/redis/redis.conf:/etc/redis/redis.conf --name myredis --rm -d registory.dongshanxia.top:35000/redis:latest redis-server /etc/redis/redis.conf --appendonly yes

# 有效
docker run -p 6379:6379 --name myredis -v /usr/local/docker/redis/redis.conf:/etc/redis/redis.conf -v /usr/local/docker/redis/data:/data -d registory.dongshanxia.top:35000/redis:latest redis-server /etc/redis/redis.conf --appendonly yes
```

bgsave命令，redis 记录rdb快照时，如何不阻塞主线程？

一般我们拍照时，如果有人晃动了，那照片也得重新拍，所以拍照时必要保证被拍照的人静止，也就是内存中的数据不变。

redis保存快照也是这样，先说保存快照的过程：

当进行快照记录时，主线程会fork出子进程，fork会阻塞主线程，子进程和主线程此时共享一块内存空间，主线程可以继续接口命令，执行命令，子进程对内存中的数据进行日志记录，**但是这就会有一个问题，子进程不能对正在修改的数据进行日志记录**（如果数据一直变动，那岂不是每次记录还得校验下每块数据是否有变动，大大降低记录的效率，这感觉有点像java的list集合，遍历时不允许对集合中的数据做删除，添加操作）

> 你可能会想到，可以用 **bgsave 避免阻塞**啊。这里我就要说到一个常见的误区了，避免阻塞和正常处理写操作并不是一回事。此时，主线程的确没有阻塞，可以正常接收请求，但是，为了保证快照完整性，它只能处理读操作，因为不能修改正在执行快照的数据。

redis的作者利用了操作系统提供的COW (copy on write)技术，当主线程对某一块数据进行操作（增删改）时，这时主线程会复制一份副本出来，这个副本提供给子进程进行日志记录，这样主线程和子进程就会不影响，既主线程可以接受命令，子进程进行日志记录啦。

![image-20221025201511153](https://img.ggball.top/img/image-20221025201511153.png?picGo)