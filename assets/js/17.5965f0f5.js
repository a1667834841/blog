(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{479:function(s,t,_){"use strict";_.r(t);var e=_(20),l=Object(e.a)({},(function(){var s=this,t=s.$createElement,_=s._self._c||t;return _("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[_("h1",{attrs:{id:"msql的sql-mode修改"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#msql的sql-mode修改"}},[s._v("#")]),s._v(" Msql的sql_mode修改")]),s._v(" "),_("h3",{attrs:{id:"问题复现"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#问题复现"}},[s._v("#")]),s._v(" 问题复现")]),s._v(" "),_("p",[s._v("今天突然发现MySQL服务器升级之后"),_("code",[s._v("sql_mode")]),s._v("变成宽松摸索了，危害如下：\n"),_("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1127869/201902/1127869-20190214132637606-1534393261.png",alt:"img"}})]),s._v(" "),_("h3",{attrs:{id:"临时解决"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#临时解决"}},[s._v("#")]),s._v(" 临时解决")]),s._v(" "),_("p",[_("code",[s._v("set global sql_mode='strict_trans_tables'")]),s._v("（阿里服务器默认是："),_("code",[s._v("strict_trans_tables")]),s._v("）\n"),_("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1127869/201902/1127869-20190214132648116-477656439.png",alt:"img"}})]),s._v(" "),_("h3",{attrs:{id:"重启失效验证"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#重启失效验证"}},[s._v("#")]),s._v(" 重启失效验证")]),s._v(" "),_("p",[s._v("上面这种方式在MySQL重启后就会失效，想要永久生效还得联系运维工程师，eg：\n"),_("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1127869/201902/1127869-20190214135955659-337645348.png",alt:"img"}})]),s._v(" "),_("h3",{attrs:{id:"配置文件"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[s._v("#")]),s._v(" 配置文件")]),s._v(" "),_("p",[s._v("PS：为了防止再出现升级后"),_("code",[s._v("SQL_Mode")]),s._v("改变，以后在配置文件中设置"),_("code",[s._v("SQL_Mode")]),s._v(" "),_("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1127869/201902/1127869-20190214140103963-1082642754.png",alt:"img"}})]),s._v(" "),_("p",[_("img",{attrs:{src:"https://img2018.cnblogs.com/blog/1127869/201902/1127869-20190214140108911-924915810.png",alt:"img"}})]),s._v(" "),_("h3",{attrs:{id:"知识点"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#知识点"}},[s._v("#")]),s._v(" 知识点")]),s._v(" "),_("ul",[_("li",[_("p",[_("code",[s._v("SQL Model")])]),s._v(" "),_("p",[s._v("：定义MySQL对约束的响应行为：")]),s._v(" "),_("ul",[_("li",[_("p",[s._v("会话修改：")]),s._v(" "),_("ul",[_("li",[s._v("mysql> "),_("code",[s._v("set [session] sql_model='xx_mode'")])]),s._v(" "),_("li",[s._v("mysql> "),_("code",[s._v("set @@session.sql_mode='xx_mode'")])]),s._v(" "),_("li",[_("strong",[s._v("PS：只在当前会话生效")])])])]),s._v(" "),_("li",[_("p",[s._v("全局修改：需要有权限，并且不会立即生效，对以后新建的会话生效（从全局继承的）")]),s._v(" "),_("ul",[_("li",[s._v("mysql> "),_("code",[s._v("set global sql_mode='xx_mode'")])]),s._v(" "),_("li",[s._v("mysql> "),_("code",[s._v("set @@global.sql_mode='xx_mode'")])]),s._v(" "),_("li",[_("strong",[s._v("PS：MySQL重启后失效")])])])]),s._v(" "),_("li",[_("p",[s._v("配置修改：永远生效：")]),s._v(" "),_("ul",[_("li",[_("p",[s._v("eg："),_("code",[s._v("vi /etc/my.cnf")]),s._v("，在"),_("code",[s._v("[mysqld]")]),s._v("下添加"),_("code",[s._v("sql_mode='xx'")]),s._v("，然后重启数据库")])]),s._v(" "),_("li",[_("p",[s._v("PS：从MySQL8开始,可通过")]),s._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[s._v("set persist\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[s._v("命令将全局变量的修改持久化到配置文件中")]),s._v(" "),_("ul",[_("li",[_("strong",[s._v("持久化到"),_("code",[s._v("/var/lib/mysql/mysqld-auto.cnf")]),s._v("配置文件中")])]),s._v(" "),_("li",[s._v("eg："),_("code",[s._v("set persist log_timestamps='SYSTEM';")]),s._v("（需要root权限）")])])])])]),s._v(" "),_("li",[_("p",[s._v("常用mode")]),s._v(" "),_("p",[s._v("：（阿里服务器默认是：")]),s._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[s._v("strict_trans_tables\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[s._v("）")]),s._v(" "),_("ul",[_("li",[_("p",[_("strong",[_("code",[s._v("traditional")])]),s._v("：使用传统模型，不允许对非法值做插入操作")])]),s._v(" "),_("li",[_("p",[_("code",[s._v("strict_all_tables")]),s._v("：对所有表做严格约束")])]),s._v(" "),_("li",[_("p",[_("code",[s._v("strict_trans_tables")]),s._v("：对所有支持事物类型的表做严格约束")]),s._v(" "),_("p",[s._v("：")]),s._v(" "),_("ul",[_("li",[s._v("PS："),_("strong",[s._v("最常见")]),s._v("，主要对事物型的存储引擎生效，其他的没效果（如果插入数据不符合规范，则中断当前操作）")])])]),s._v(" "),_("li",[_("p",[_("strong",[_("code",[s._v("no_engine_substitution")]),s._v("：建表的时候指定不可用存储引擎会报错")])])]),s._v(" "),_("li",[_("p",[_("code",[s._v("only_full_group_by")])]),s._v(" "),_("p",[s._v("：检验")]),s._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[s._v("group by\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("p",[s._v("语句的合法性")]),s._v(" "),_("ul",[_("li",[_("p",[s._v("要求在在分组查询语句中，把所有没有使用聚合函数的列，列出来")])]),s._v(" "),_("li",[_("p",[s._v("eg：")]),s._v(" "),_("div",{staticClass:"language- line-numbers-mode"},[_("pre",{pre:!0,attrs:{class:"language-text"}},[_("code",[s._v("select count(url),name from file_records group by url;\n")])]),s._v(" "),_("div",{staticClass:"line-numbers-wrapper"},[_("span",{staticClass:"line-number"},[s._v("1")]),_("br")])]),_("ul",[_("li",[s._v("使用了name字段，name不是聚合函数，那必须在group by中写一下")])])])])]),s._v(" "),_("li",[_("p",[_("strong",[s._v("PS：生存环境下最好不要修改，容易报错对业务产生影响（严格变宽松没事）")])])]),s._v(" "),_("li",[_("p",[s._v("查询当前设置："),_("strong",[_("code",[s._v("select @@sql_mode")])])])])])])])])]),s._v(" "),_("p",[_("a",{attrs:{href:"https://www.cnblogs.com/dotnetcrazy/p/10374091.html#_map4",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客转发"),_("OutboundLink")],1),s._v(")")])])}),[],!1,null,null,null);t.default=l.exports}}]);